```
import { useRef, useState, useEffect } from "react";
import { useGlobalStore } from "../store/store.tsx";
import { useOutletContext } from "react-router-dom";
import { assets } from "../assets/assets.ts";
import type { SportsContextType } from "../types/global/outlet.ts";
import { getUserSetting, sportsSetting } from "../api/colorSystemAPI.ts";
import { AxiosError } from "axios";
import { useQuery } from "@tanstack/react-query";

interface SportsCategory {
  title: string; // 例子中都是 "displaySports"
  value: string; // 運動名稱，例如 "Soccer", "Tennis", "Cricket"
  checked: boolean; // 是否選中
  id: string; // id 字串，會用到 extractNumericId
}

/**
 * 從 id 中萃取數字，支援多種格式
 * @param {string} id
 * @returns {number|null} 取不到數字則回傳 null
 */
function extractNumericId(id: string): number | null {
  const match = id.match(/^sr:sport:(\d+)$/) || id.match(/^(\d+)$/);
  return match ? parseInt(match[1], 10) : null;
}

/**
 * 運動分類排序函式
 * - 有合法數字id者優先，按數字由小到大
 * - 沒合法數字id者保持原順序
 * @param {Array<{id: string, [key: string]: any}>} categories
 * @returns 同型陣列排序結果
 */
function sortSportsCategories(categories: SportsCategory[]): SportsCategory[] {
  if (!Array.isArray(categories) || categories.length === 0) return categories;
  return categories.slice().sort((a, b) => {
    const aNum = extractNumericId(a.id);
    const bNum = extractNumericId(b.id);

    // 都有數字，照數字排序
    if (aNum !== null && bNum !== null) return aNum - bNum;
    // 只有a合法，a優先
    if (aNum !== null) return -1;
    // 只有b合法，b優先
    if (bNum !== null) return 1;
    // 都不合法，原順序
    return 0;
  });
}

export default function Sports() {
  const sportsCategories = useGlobalStore((state) => state.sportsCategories);
  const setSportsCategories = useGlobalStore(
    (state) => state.setSportsCategories
  );
  const setSelectedIds = useGlobalStore((state) => state.setSelectedIds);
  const addId = useGlobalStore((state) => state.addId);
  const selectedIds = useGlobalStore((state) => state.selectedIds);
  // 先把球種清單存在全局
  const { data: sportsCategoriesList } = useQuery({
    queryKey: ["sportsSetting"],
    queryFn: async () => {
      const res = await sportsSetting();
      const sorted = sortSportsCategories(res.data.sportsCategories);
      setSportsCategories(sorted); 
      return sorted; 
    },
    staleTime: Infinity,
    retry: false,
  });
  // 拿到球種清單後，才把已經選取的球種紀錄在全局
  const { data: selected_sport } = useQuery({
    queryKey: ["getUserSetting"],
    queryFn: async () => {
      const res = await getUserSetting();
      const selected = res.data.spec_setting.selected_sport;
      setSelectedIds(selected);
      return selected;
    },
    staleTime: Infinity,
    retry: false,
    enabled: sportsCategoriesList !== undefined,
  });

  const handleClick = (id: string) => {
    addId(id);
  };

  const RequirementRow = ({
    id,
    onClick,
  }: {
    id: string;
    onClick: () => void;
  }) => {
    const iconSrc = selectedIds.includes(String(id)) ? assets.function_succes : assets.onLiveDot;
    return (
      <div
        onClick={onClick}
        className={`flex items-center gap-1 cursor-pointer space-y-1`}
      >
        <img src={iconSrc} alt="" className="w-[12px]" />
      </div>
    );
  };

  return (
    <div
      className={`h-full flex flex-col bg-secondary-400-light dark:bg-secondary-400-dark overflow-hidden transition-all duration-300 ease-in-out relative ${
        expanded ? "w-[260px]" : "w-0"
      }`}
    >
        <div className="p-4 flex flex-col text-secondary-1000-light dark:text-secondary-1000-dark">
          {/* <RequirementRow
            key="all"
            text="All"
            checked={allChecked}
            onClick={() => handleSelect("all")}
          /> */}
          <div className="grid md:grid-cols-2">
            {sportsCategories?.map(({ id, value, checked }) => (
              <RequirementRow
                key={id}
                id={id}
                text={value}
                checked={checked}
                onClick={() => handleClick(id)}
              />
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}
```

```
export const useGlobalStore = create<globalState>((set) => ({
  selectedIds: [], // 用這個狀態來記錄使用者當下操作的球種
  addId: (id) =>
    set((state) => {
      console.log('addId', state.selectedIds, id);
      if (state.selectedIds.includes(id)) {
        return { selectedIds: state.selectedIds.filter((item) => item !== id) };
      } else {
        return { selectedIds: [...state.selectedIds, id] };
      }
    }),
  setSelectedIds: (ids) => set({ selectedIds: ids }),
  sportsCategories: [],
  setSportsCategories: (categories) => set({ sportsCategories: categories }),
```
