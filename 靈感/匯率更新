
## ğŸ§© çˆ¶å…ƒä»¶ï¼šä½¿ç”¨ useLiveRates() æ­é… CurrencyItem

### å¦‚æœ Portfolio æ˜¯æŸå€‹çˆ¶å±¤ï¼ˆç”šè‡³ç¥–çˆ¶å±¤ï¼‰çš„å­çµ„ä»¶ï¼Œç•¶å®ƒè‡ªå·±æ›´æ–°æ™‚ï¼Œçˆ¶å±¤æœƒä¸æœƒè·Ÿè‘— re-renderï¼Ÿ

ğŸ¯ ç°¡å–®çµè«–ï¼š
ä¸æœƒï¼åªè¦çˆ¶å±¤æœ¬èº«æ²’æœ‰ state/props æ”¹è®Šï¼Œå°±ä¸æœƒ re-renderã€‚

```
import React from 'react';
import { useLiveRates } from './useLiveRates';
import CurrencyItem from './CurrencyItem';

const Portfolio = () => {
  const rates = useLiveRates();

  // å‡è¨­é€™æ˜¯ä½¿ç”¨è€…çš„è³‡ç”¢
  const holdings = [
    { symbol: 'BTC', amount: 0.5 },
    { symbol: 'ETH', amount: 2.3 },
    { symbol: 'SOL', amount: 100 },
  ];

  return (
    <div>
      {holdings.map(asset => (
        <CurrencyItem
          key={asset.symbol}
          symbol={asset.symbol}
          amount={asset.amount}
          rate={rates[asset.symbol] ?? 0} // æ²’è³‡æ–™æ™‚çµ¦ 0
        />
      ))}
    </div>
  );
};
```

## ğŸ§± CurrencyItem ç¶­æŒä¸è®Šï¼Œç”¨ React.memo æå‡æ•ˆèƒ½

```

import React, { useMemo } from 'react';

const CurrencyItem = React.memo(({ symbol, amount, rate }) => {
  const displayValue = useMemo(() => amount * rate, [amount, rate]);
  return (
    <div>
      {symbol}: {amount} â‰ˆ ${displayValue.toFixed(2)}
    </div>
  );
});

```
## ã€Œæˆ‘å€‘è¦æ›´æ–° rates çš„å€¼ï¼Œä½†åªåœ¨è³‡æ–™çœŸçš„æœ‰è®ŠåŒ–çš„æ™‚å€™æ‰æ›´æ–°ã€‚ã€
```
import { useEffect, useState } from 'react';

export function useLiveRates() {
  const [rates, setRates] = useState({}); // { BTC: 62700.12, ETH: 3120.45, ... }

  useEffect(() => {
    const ws = new WebSocket('wss://your-feed.com/rates');

    ws.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);
        // ç¯„ä¾‹: { BTC: 62700.12, ETH: 3120.45 }
        setRates(prev => {
          // åªåœ¨æœ‰å¯¦è³ªè®Šå‹•æ™‚æ›´æ–°
          const hasChanged = Object.keys(data).some(
            key => data[key] !== prev[key]
          );
          return hasChanged ? data : prev;
        });
      } catch (e) {
        console.error('Invalid WebSocket message:', e);
      }
    };

    return () => ws.close();
  }, []);

  return rates;
}

```
