ðŸ§  ç›®æ¨™æƒ…å¢ƒèªªæ˜Ž

ä½ æ”¶åˆ°ä¸€å€‹ curMessageï¼Œè£¡é¢åŒ…å«æŸå€‹ä½¿ç”¨è€…çš„æœ€æ–°æ‰“å¡ç´€éŒ„ã€‚

ä½ è¦æ¯”å°æ˜¯å¦æ˜¯ã€Œç›®æ¨™ä½¿ç”¨è€…ã€çš„æ‰“å¡è³‡æ–™ã€‚

ä¸¦ä¸”æª¢æŸ¥é€™æ¬¡æ‰“å¡æ™‚é–“æ˜¯å¦ã€Œèˆ‡å‰ä¸€æ¬¡ä¸ä¸€è‡´ã€â†’ è¡¨ç¤ºæœ‰æ‰“å¡æ›´æ–°ã€‚



---

ðŸ“¦ å‡è³‡æ–™çµæ§‹ï¼ˆæ”¹ç‚ºè€ƒå‹¤ï¼‰

const curMessage = {
  events: [
    {
      records: [
        {
          userId: 'A001',
          punches: [
            { time: '2025-07-08T08:01:00Z', type: 'in' }, // ä¸Šç­æ‰“å¡
            { time: '2025-07-08T12:00:00Z', type: 'out' } // ä¸‹ç­æ‰“å¡
          ]
        }
      ]
    }
  ]
};

const userDetail = {
  user_id: 'A001'
};

const lastPunchTime = '2025-07-08T08:00:00Z'; // ä¸Šæ¬¡æ‰“å¡è¨˜éŒ„æ™‚é–“
const punchType = 'in'; // è¦æ¯”å°çš„æ˜¯ä¸Šç­æ‰“å¡


---

âœ… æ”¹å¯«é‚è¼¯ç¨‹å¼ç¢¼

const recordData = curMessage?.events?.[0]?.records?.[0];

// å¦‚æžœä¸æ˜¯ç›®æ¨™ä½¿ç”¨è€…ï¼Œå°±å¿½ç•¥
if (recordData?.userId !== userDetail?.user_id) return false;

// æ‰¾åˆ°ç›®æ¨™é¡žåž‹çš„æ‰“å¡ï¼ˆä¾‹å¦‚ type === 'in'ï¼‰
const targetPunch = recordData?.punches?.find((p) => p.type === punchType);

// æª¢æŸ¥æ™‚é–“æ˜¯å¦èˆ‡ä¸Šæ¬¡æ‰“å¡ä¸åŒ
const hasUpdatedPunch = targetPunch && targetPunch.time !== lastPunchTime;

return hasUpdatedPunch;


---

ðŸ§ª å¯¦ä¾‹ï¼šä¸‰ç¨®çµæžœ

1ï¸âƒ£ âœ… è³‡æ–™ç›¸ç¬¦ã€æ™‚é–“ä¸åŒ â†’ å›žå‚³ true

lastPunchTime = '2025-07-08T08:00:00Z';
targetPunch.time = '2025-07-08T08:01:00Z'; // å·²æ›´æ–°

2ï¸âƒ£ âŒ è³‡æ–™ç›¸ç¬¦ã€ä½†æ™‚é–“ç›¸åŒ â†’ å›žå‚³ false

lastPunchTime = '2025-07-08T08:01:00Z';
targetPunch.time = '2025-07-08T08:01:00Z'; // ç„¡è®ŠåŒ–

3ï¸âƒ£ âŒ ä½¿ç”¨è€…ä¸ç¬¦ â†’ å›žå‚³ false

userDetail.user_id = 'B999';
recordData.userId = 'A001';


---

ðŸ§© åŒ…æˆå‡½æ•¸ (å¯é‡ç”¨)

å¦‚æžœä½ æƒ³åšæˆå·¥å…·å‡½æ•¸ï¼Œé€™æ¨£å¯«ï¼š

function hasUpdatedPunch(curMessage, userDetail, lastPunchTime, punchType = 'in') {
  const recordData = curMessage?.events?.[0]?.records?.[0];
  if (recordData?.userId !== userDetail?.user_id) return false;

  const targetPunch = recordData?.punches?.find((p) => p.type === punchType);
  return targetPunch && targetPunch.time !== lastPunchTime;
}


---
